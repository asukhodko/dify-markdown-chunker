identity:
  name: markdown_chunk_tool
  author: asukhodko
  label:
    en_US: Markdown Chunker
    zh_Hans: Markdown 分块器
    ru_RU: Markdown чанкер
  icon: icon.svg

description:
  human:
    en_US: Advanced Markdown chunking with structural awareness for better RAG performance. Intelligently splits documents while preserving context and structure.
    zh_Hans: 具有结构感知的高级 Markdown 分块，提升 RAG 性能。智能分割文档，同时保留上下文和结构。
    ru_RU: Продвинутое чанкование Markdown с учётом структуры для улучшения RAG. Интеллектуально разделяет документы, сохраняя контекст и структуру.
  llm: |
    A tool for chunking Markdown documents with structural awareness.
    
    This tool analyzes Markdown content and intelligently splits it into chunks while preserving document structure,
    maintaining semantic context, supporting configurable chunk size and overlap, and providing rich metadata.
    
    Use this tool when you need to process large Markdown documents for RAG systems.

parameters:
  - name: input_text
    type: string
    required: true
    form: llm
    label:
      en_US: Input Text
      zh_Hans: 输入文本
      ru_RU: Входной текст
    human_description:
      en_US: The Markdown text content to be chunked
      zh_Hans: 要分块的 Markdown 文本内容
      ru_RU: Текстовое содержимое Markdown для разделения на части
    llm_description: The Markdown document text that needs to be split into chunks for processing

  - name: max_chunk_size
    type: number
    required: false
    default: 4096
    form: form
    label:
      en_US: Max Chunk Size
      zh_Hans: 最大块大小
      ru_RU: Максимальный размер части
    human_description:
      en_US: "Maximum size of each chunk in characters (default: 4096)"
      zh_Hans: "每个块的最大字符数（默认：4096）"
      ru_RU: "Максимальный размер каждой части в символах (по умолчанию: 4096)"
    llm_description: Maximum number of characters allowed in each chunk. Larger values create bigger chunks with more context.

  - name: chunk_overlap
    type: number
    required: false
    default: 200
    form: form
    label:
      en_US: Chunk Overlap
      zh_Hans: 块重叠
      ru_RU: Перекрытие частей
    human_description:
      en_US: "Number of characters to overlap between consecutive chunks (default: 200, 0 to disable). Overlap is stored in chunk metadata."
      zh_Hans: "连续块之间重叠的字符数（默认：200，0 表示禁用）。重叠存储在块元数据中。"
      ru_RU: "Количество символов для перекрытия между последовательными частями (по умолчанию: 200, 0 для отключения). Перекрытие хранится в метаданных."
    llm_description: Number of characters that overlap between consecutive chunks to maintain context continuity. Set to 0 to disable overlap.

  - name: strategy
    type: select
    required: false
    default: auto
    form: form
    label:
      en_US: Chunking Strategy
      zh_Hans: 分块策略
      ru_RU: Стратегия разделения
    human_description:
      en_US: "Strategy for chunking the document (default: auto - automatically detect best strategy based on content analysis)"
      zh_Hans: "文档分块策略（默认：auto - 根据内容分析自动检测最佳策略）"
      ru_RU: "Стратегия разделения документа (по умолчанию: auto - автоматически определить лучшую стратегию на основе анализа контента)"
    llm_description: The chunking strategy to use. Auto automatically selects the best strategy based on content analysis (code ratio, structure complexity).
    options:
      - value: auto
        label:
          en_US: Auto (detect best strategy)
          zh_Hans: 自动（检测最佳策略）
          ru_RU: Авто (определить лучшую стратегию)
      - value: code_aware
        label:
          en_US: Code-Aware (preserves code blocks)
          zh_Hans: 代码感知（保留代码块）
          ru_RU: С учётом кода (сохраняет блоки кода)
      - value: structural
        label:
          en_US: Structural (header-based)
          zh_Hans: 结构化（基于标题）
          ru_RU: Структурная (по заголовкам)
      - value: fallback
        label:
          en_US: Fallback (simple splitting)
          zh_Hans: 回退（简单分割）
          ru_RU: Базовая (простое разделение)

  - name: include_metadata
    type: boolean
    required: false
    default: true
    form: form
    label:
      en_US: Include Metadata
      zh_Hans: 包含元数据
      ru_RU: Включить метаданные
    human_description:
      en_US: "Include structural metadata with each chunk (default: true). Metadata includes content type, header path, line numbers, and overlap context."
      zh_Hans: "在每个块中包含结构元数据（默认：true）。元数据包括内容类型、标题路径、行号和重叠上下文。"
      ru_RU: "Включить структурные метаданные в каждую часть (по умолчанию: true). Метаданные включают тип контента, путь заголовков, номера строк и контекст перекрытия."
    llm_description: "Whether to include metadata about chunk structure, content type, header path, line numbers, and overlap context for better RAG retrieval."

output_schema:
  type: object
  properties:
    result:
      $ref: "https://dify.ai/schemas/v1/general_structure.json"

extra:
  python:
    source: tools/markdown_chunk_tool.py
