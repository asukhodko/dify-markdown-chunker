identity:
  name: markdown_chunk_tool
  author: asukhodko
  label:
    en_US: Markdown Chunker
    zh_Hans: Markdown 分块器
    ru_RU: Markdown чанкер
  icon: icon.svg

description:
  human:
    en_US: Advanced Markdown chunking with structural awareness for better RAG performance. Intelligently splits documents while preserving context and structure.
    zh_Hans: 具有结构感知的高级 Markdown 分块，提升 RAG 性能。智能分割文档，同时保留上下文和结构。
    ru_RU: Продвинутое чанкование Markdown с учётом структуры для улучшения RAG. Интеллектуально разделяет документы, сохраняя контекст и структуру.
  llm: |
    A tool for chunking Markdown documents with structural awareness.
    
    This tool analyzes Markdown content and intelligently splits it into chunks while preserving document structure,
    maintaining semantic context, supporting configurable chunk size and overlap, and providing rich metadata.
    
    Use this tool when you need to process large Markdown documents for RAG systems.

parameters:
  - name: input_text
    type: string
    required: true
    form: llm
    label:
      en_US: Input Text
      zh_Hans: 输入文本
      ru_RU: Входной текст
    human_description:
      en_US: The Markdown text content to be chunked
      zh_Hans: 要分块的 Markdown 文本内容
      ru_RU: Текстовое содержимое Markdown для разделения на части
    llm_description: The Markdown document text that needs to be split into chunks for processing

  - name: max_chunk_size
    type: number
    required: false
    default: 4096
    form: form
    label:
      en_US: Max Chunk Size
      zh_Hans: 最大块大小
      ru_RU: Максимальный размер части
    human_description:
      en_US: "Maximum size of each chunk in characters (default: 4096)"
      zh_Hans: "每个块的最大字符数（默认：4096）"
      ru_RU: "Максимальный размер каждой части в символах (по умолчанию: 4096)"
    llm_description: Maximum number of characters allowed in each chunk. Larger values create bigger chunks with more context.

  - name: chunk_overlap
    type: number
    required: false
    default: 200
    form: form
    label:
      en_US: Chunk Overlap
      zh_Hans: 块重叠
      ru_RU: Перекрытие частей
    human_description:
      en_US: "Characters to overlap between chunks (default: 200, 0 to disable). With include_metadata=true, overlap is in metadata fields. With include_metadata=false, overlap is embedded in chunk text."
      zh_Hans: "块之间重叠的字符数（默认：200，0 表示禁用）。include_metadata=true 时，重叠存储在元数据字段。include_metadata=false 时，重叠嵌入到块文本中。"
      ru_RU: "Символов перекрытия между частями (по умолчанию: 200, 0 для отключения). При include_metadata=true перекрытие в полях метаданных. При include_metadata=false перекрытие встраивается в текст части."
    llm_description: Number of characters that overlap between consecutive chunks. With include_metadata=true, overlap is in metadata fields (previous_content/next_content). With include_metadata=false, overlap is embedded directly into chunk text.

  - name: strategy
    type: select
    required: false
    default: auto
    form: form
    label:
      en_US: Chunking Strategy
      zh_Hans: 分块策略
      ru_RU: Стратегия разделения
    human_description:
      en_US: "Strategy for chunking the document (default: auto - automatically detect best strategy based on content analysis)"
      zh_Hans: "文档分块策略（默认：auto - 根据内容分析自动检测最佳策略）"
      ru_RU: "Стратегия разделения документа (по умолчанию: auto - автоматически определить лучшую стратегию на основе анализа контента)"
    llm_description: The chunking strategy to use. Auto automatically selects the best strategy based on content analysis (code ratio, structure complexity).
    options:
      - value: auto
        label:
          en_US: Auto (detect best strategy)
          zh_Hans: 自动（检测最佳策略）
          ru_RU: Авто (определить лучшую стратегию)
      - value: code_aware
        label:
          en_US: Code-Aware (preserves code blocks)
          zh_Hans: 代码感知（保留代码块）
          ru_RU: С учётом кода (сохраняет блоки кода)
      - value: list_aware
        label:
          en_US: List-Aware (preserves list hierarchy)
          zh_Hans: 列表感知（保留列表层次结构）
          ru_RU: С учётом списков (сохраняет иерархию списков)
      - value: structural
        label:
          en_US: Structural (header-based)
          zh_Hans: 结构化（基于标题）
          ru_RU: Структурная (по заголовкам)
      - value: fallback
        label:
          en_US: Fallback (simple splitting)
          zh_Hans: 回退（简单分割）
          ru_RU: Базовая (простое разделение)

  - name: include_metadata
    type: boolean
    required: false
    default: true
    form: form
    label:
      en_US: Include Metadata
      zh_Hans: 包含元数据
      ru_RU: Включить метаданные
    human_description:
      en_US: "Embed metadata in chunk text (default: true). When enabled, chunks have <metadata> block with content_type, header_path, line numbers; overlap stays in metadata. When disabled, overlap is embedded into chunk text as: previous_content + main + next_content."
      zh_Hans: "在块文本中嵌入元数据（默认：true）。启用时，块有 <metadata> 块包含 content_type、header_path、行号；重叠在元数据中。禁用时，重叠嵌入块文本：previous_content + main + next_content。"
      ru_RU: "Встраивать метаданные в текст (по умолчанию: true). При включении части имеют блок <metadata> с content_type, header_path, номерами строк; перекрытие в метаданных. При отключении перекрытие встраивается в текст: previous_content + main + next_content."
    llm_description: "Embed metadata in chunk text. When true, chunks have <metadata> block; overlap context in metadata fields. When false, no metadata block; overlap embedded directly into chunk text (previous_content + main + next_content)."

output_schema:
  type: object
  properties:
    result:
      $ref: "https://dify.ai/schemas/v1/general_structure.json"

extra:
  python:
    source: tools/markdown_chunk_tool.py
