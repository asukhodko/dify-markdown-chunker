# GAP-анализ `dify-markdown-chunker` относительно требований Dify Marketplace

## 1. Краткий обзор

`dify-markdown-chunker` — это инструмент-плагин для Dify, который делает «умное» чанкование Markdown: учитывает структуру документа, заголовки, код, таблицы, позволяет настраивать размер чанков и пересечение, и заточен под RAG/knowledge-base сценарии в Dify.

По сути, это отдельный Dify-плагин + переиспользуемая Python-библиотека. Задача GAP-анализа — посмотреть, чего не хватает до формального соответствия требованиям публикации в Dify Marketplace.

---

## 2. Что уже хорошо закрыто

Здесь всё выглядит весьма взрослым:

1. **README и документация**

   * README большой, структурированный:

     * есть описание фич;
     * примеры использования как Python-библиотеки;
     * секция про установку плагина в Dify (через `.difypkg` из Releases);
     * примеры интеграции в Dify-workflow и knowledge ingestion.
   * Это покрывает требование Dify «предоставить подробный README с инструкциями по установке и использованию».

2. **Внятная ценность и отличия (на уровне фич)**

   * Плагин явно про улучшенное чанкование Markdown:

     * структурная осознанность,
     * разные стратегии (auto/code/structural/mixed),
     * чанк-метаданные, line-aware поведение и т.п.
   * То есть у него есть свой чёткий value-prop, он не выглядит «рандомным дубликатом» чего-то ещё.

3. **Манифест плагина (`manifest.yaml`)**

   * Уже есть и в целом заполнен:

     * `type: plugin`,
     * `author`, `name`,
     * `label` и `description` с локализацией (`en_US`, `zh_Hans`, `ru_RU`),
     * `icon`,
     * `resource.memory`,
     * `plugins.tools` → `provider/markdown_chunker.yaml`,
     * `meta.runner.language: python`, `version: "3.12"`, `entrypoint: main`,
     * `minimum_dify_version: 1.9.0`,
     * `tags`, `created_at`.
   * То есть базовая «форматная» часть манифеста соблюдена.

4. **Пакетирование и Releases**

   * В README есть шаги:

     * «скачать `.difypkg` из Releases»,
     * «в Dify → Settings → Plugins → Install Plugin → загрузить файл».
   * Это означает, что:

     * плагин уже умеет собираться в `.difypkg`,
     * сценарий локальной установки описан.

5. **Тесты и качество**

   * Есть `tests` + команда `make test` в README.
   * Для Marketplace это плюс: демонстрирует, что автор заботится о качестве и не выкатывает «сырое» решение.

6. **Лицензия**

   * В репозитории есть MIT-лицензия.
   * Это соответствует рекомендациям Dify: открытый код, понятные условия использования.

Иными словами: проект уже выглядит как почти готовый кандидат на Marketplace. Основные дыры — не в коде, а в «бумажках» и метаданных.

---

## 3. Основные пробелы (GAP’ы)

### 3.1. Политика конфиденциальности и поле `privacy` в манифесте

**Что требует Dify**

* Для любого плагина, который идёт в Marketplace, обязателен **privacy policy**:

  * явный ответ: собирает ли плагин персональные данные или нет;
  * если да — какие, как используются, с кем делятся;
  * если используются сторонние сервисы → ссылки на их политики.
* В `manifest.yaml` должно быть поле (или секция), указывающее **путь к файлу политики или URL**.

**Что сейчас**

* В репозитории **нет отдельного файла с политикой конфиденциальности** (что-то вроде `PRIVACY.md`, `privacy_policy.md` и т.п.).
* В `manifest.yaml` **нет** ссылки на политику (`privacy` / `privacy_policy` / аналогичного поля).

**Риск**

* На этапе ревью плагин завернут на шаге «формат / privacy», даже не дойдя до анализа фич.
* Даже если плагин не отправляет данные наружу, отсутствие явной политики — формальная причина отказа.

**Что сделать**

* Написать короткую, но чёткую Privacy Policy для плагина:

  * по сути: «Плагин обрабатывает Markdown-текст локально в окружении Dify, никуда его не отправляет, персональные данные не собирает/не хранит отдельно».
* Добавить файл в репозиторий (например, `PRIVACY.md`).
* Прописать путь или URL политики в манифесте, как требует документация Dify.

---

### 3.2. Описание обработки данных (data usage) в README

**Что требует Dify**

* В документации (и/или на странице плагина) должно быть понятно:

  * какие данные плагин видит;
  * что с ними делает;
  * отправляет ли что-то третьим лицам.

**Что сейчас**

* README в основном про фичи и использование, но нет отдельного явного раздела вроде **“Data & Privacy”**.
* При этом фактически плагин:

  * получает на вход Markdown-текст;
  * режет его на чанки;
  * не обращается к внешним API (судя по коду).

**Риск**

* Ревьюер будет вынужден «додумывать», что делает плагин с данными, и всё равно вернётся к вопросу политики.
* Пользователь в Marketplace не увидит чёткого ответа.

**Что сделать**

* Добавить в README небольшой раздел, типа:

  > ### Data & Privacy
  >
  > Плагин обрабатывает переданный ему Markdown-текст локально внутри Dify.
  > Данные не отправляются на внешние сервисы и не сохраняются вне стандартных механизмов Dify.

* Синхронизировать формулировки с текстом Privacy Policy.

---

### 3.3. Контактные данные разработчика

**Что требует Dify**

* В руководстве по публикации сказано, что при ревью проверяется, что:

  * манифест **включает корректную контактную информацию автора**;
  * у плагина есть способ связи (repo URL, e-mail, issue-трекер).

**Что сейчас**

* В `manifest.yaml` есть `author: asukhodko` — это хорошо, но:

  * нет e-mail или ссылки на страницу/репозиторий явно в манифесте;
* В README нет явного блока вида «Author / Contact / Support».

**Риск**

* Формально может считаться, что «валидный канал связи» не указан.
* Ревьюер может попросить это добавить перед принятием.

**Что сделать**

* Добавить в README секцию, например:

  > ### Author & Support
  >
  > Author: …
  > GitHub: `https://github.com/asukhodko/dify-markdown-chunker`
  > Issues: `https://github.com/asukhodko/dify-markdown-chunker/issues`
  > E-mail (при желании).

* При необходимости — добавить в манифест поле с URL репозитория/контакта (согласно актуальной схеме Manifest).

---

### 3.4. Пакетирование и размещение в официальном репозитории `dify-plugins`

Это больше «следующий шаг», но формально — тоже gap относительно требований Marketplace.

**Что требует Dify**

* Чтобы плагин появился в Marketplace, нужно:

  * форкнуть репозиторий `dify-plugins`;
  * внутри создать директорию `/<org_or_user>/<plugin_name>/`;
  * положить туда:

    * исходники плагина,
    * **упакованный файл** (`.pkg`/`.difypkg`);
  * сделать Pull Request с этим содержимым.

**Что сейчас**

* Репозиторий `dify-markdown-chunker` живёт отдельно (это нормально).
* В README описана локальная установка через `.difypkg` из Releases.
* **Но плагин ещё не вынесен в форк `dify-plugins` и PR не создан**.

**Риск**

* Пока нет PR в `dify-plugins`, Dify Marketplace о плагине вообще не знает.

**Что сделать**

* После закрытия прочих GAP’ов:

  1. Собрать актуальный `.difypkg`.
  2. Форкнуть `dify-plugins`.
  3. Создать, например, структуру:

     * `asukhodko/markdown-chunker/` (или аналогично названию в манифесте),
     * положить туда:

       * `manifest.yaml`,
       * исходники,
       * файл `.difypkg` (с номером версии из манифеста).
  4. Оформить PR по шаблону Dify, указав:

     * краткое описание плагина;
     * ссылку на основной репозиторий;
     * контакт;
     * аргументацию уникальности (см. следующий пункт).

---

### 3.5. Аргументация уникальности относительно уже существующего `md-text-chunker`

**Что требует Dify**

* Плагины не должны **дублировать** уже опубликованные:

  * если это лёгкий вариант того же самого → лучше расширить существующий;
  * если функциональные отличия значимы → это отдельный плагин, но нужно объяснить.

**Что сейчас**

* В Marketplace уже есть `md-text-chunker`.
* `dify-markdown-chunker` по сути решает ту же задачу на другом уровне качества (стратегии, структурность, метаданные и т.д.).
* В README `dify-markdown-chunker` нет отдельного раздела «чем мой плагин отличается от существующего».

**Риск**

* Ревьюер увидит: «ещё один Markdown chunker», зайдёт в репо `Biaoo/md-text-chunker` и спросит:

  * почему это не PR в тот плагин?
  * что принципиально нового даёт новый плагин?

**Что сделать**

* Добавить в README небольшой раздел, например:

  > ### Comparison with existing Markdown chunkers
  >
  > * Более сложная модель структуры документа (…);
  > * Продвинутые стратегии (auto/code/structural/mixed);
  > * Линейно-осознанные диапазоны (строки/позиции) и др.

* В PR в `dify-plugins`:

  * явно сослаться на существующий `md-text-chunker`;
  * кратко объяснить, почему тут отдельный плагин:

    * другой алгоритмический подход,
    * расширенный набор фич,
    * другая точка компромисса между качеством и производительностью.

---

### 3.6. Дополнительные поля манифеста / метаданные (nice-to-have)

Это не жёсткие блокеры, но улучшения:

* Добавить в `meta` или рядом:

  * ссылку на репозиторий (`repository`/`homepage`),
  * при необходимости — ссылку на issue-трекер.
* Проверить, что:

  * `resource.memory` реалистичен относительно фактического потребления;
  * `minimum_dify_version` актуальна.

---

### 3.7. Локализация README (опционально)

**Требование**

* Dify требует, чтобы интерфейс был **как минимум на английском**. Это выполнено.

**Сейчас**

* README целиком на английском (что ок).
* UI-строки в манифесте уже локализованы на `zh_Hans` и `ru_RU`.

**Что можно улучшить**

* Если хочется, можно добавить в README короткий раздел «Overview (RU)» в конце или начале — в качестве «quality of life» для русскоязычных пользователей. Но это не влияет на модерацию.

---

### 3.8. Явная секция «Support / Maintenance»

**Требование**

* Dify ожидает, что у плагина:

  * есть понятный канал поддержки,
  * автор в целом готов поддерживать плагин (обновлять, реагировать на issues).

**Сейчас**

* Канал по факту есть (Issues на GitHub), но это не проговорено текстом в README.

**Что сделать**

* Добавить небольшой блок:

  > ### Support & Maintenance
  >
  > * Bug reports and feature requests: GitHub Issues
  > * Planned support status: actively maintained / best effort / etc.

---

## 4. Сводная таблица GAP’ов

| Требование / область               | Текущее состояние                                  | Что нужно сделать                                                            |
| ---------------------------------- | -------------------------------------------------- | ---------------------------------------------------------------------------- |
| **Privacy Policy**                 | Нет отдельной политики, нет ссылки в манифесте     | Написать `PRIVACY.md`, добавить ссылку в `manifest`                          |
| **Описание обработки данных**      | В README нет явного раздела про data/privacy       | Добавить раздел, описывающий локальную обработку                             |
| **Контакты автора**                | Только `author: asukhodko` в манифесте             | Добавить секцию «Author / Contact» в README, при желании — URL в манифест    |
| **Пакет в `dify-plugins` и PR**    | Плагин только в личном репо, без PR                | Форк `dify-plugins`, создать директорию, положить код+`.difypkg`, сделать PR |
| **Аргументация уникальности**      | README не сравнивает плагин с `md-text-chunker`    | Добавить сравнение в README, объяснить в PR зачем отдельный плагин           |
| **Доп. метаданные манифеста**      | Базовый набор есть, но нет ссылки на репо/политику | Добавить `privacy`, возможно `repository/homepage`                           |
| **Секция Support / Maintenance**   | Не выделена явно                                   | Добавить блок в README с описанием поддержки                                 |
| **Локализация README (RU/другие)** | README только на английском                        | (Необязательно) добавить краткое резюме на других языках                     |

---

## 5. Конкретный план закрытия GAP’ов

1. **Политика конфиденциальности**

   * Написать `PRIVACY.md` для плагина:

     * чётко описать, что Markdown обрабатывается локально;
     * указать, что данные не отправляются третьим лицам;
     * если позже появятся внешние интеграции — дописать их туда.
   * Добавить в `manifest.yaml` поле с путём/URL политики.

2. **Data & Privacy в README**

   * Добавить раздел:

     * что плагин видит (Markdown-текст),
     * что делает (структурное чанкование),
     * чего не делает (не логирует отдельно, не отправляет наружу).

3. **Контакты и поддержка**

   * В конец README:

     * секция «Author & Support» с ссылками на GitHub и Issues;
     * при желании — e-mail.
   * (Опционально) добавить в манифест поле с URL репозитория.

4. **Уникальность vs `md-text-chunker`**

   * Добавить в README короткий раздел сравнения:

     * чем отличаются стратегии,
     * структурность,
     * метаданные, UX, производительность.
   * В тексте PR в `dify-plugins` явно описать:

     * «почему это отдельный плагин, а не PR в существующий».

5. **Подготовка к PR в `dify-plugins`**

   * Убедиться, что:

     * манифест валиден,
     * privacy-policy на месте,
     * README и контакты — обновлены.
   * Собрать свежий `.difypkg`.
   * Форкнуть `dify-plugins`, создать нужную структуру директорий.
   * Залить исходники и `.difypkg`, сделать PR по их шаблону.

6. **Косметика (по желанию)**

   * Добавить краткое русское резюме в README.
   * Чётко указать поддерживаемую версию Dify и Python в README, чтобы это совпадало с манифестом.
   * При желании — добавить бэджик CI/тестов, чтобы ревьюеру было приятнее.
