# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Stage 1

## üìã –û–±–∑–æ—Ä

Stage 1 –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏.

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ—à–∞–µ—Ç –æ–¥–Ω—É –∑–∞–¥–∞—á—É
2. **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è** - –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞
3. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–∞—Ä—Å–µ—Ä—ã –∏ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
4. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
5. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## üèõÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
stage1/
‚îú‚îÄ‚îÄ types.py              # –ë–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ config.py             # –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ errors.py             # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îú‚îÄ‚îÄ 
‚îú‚îÄ‚îÄ markdown_ast.py       # –ü–∞—Ä—Å–∏–Ω–≥ –≤ AST
‚îú‚îÄ‚îÄ fenced_block_extractor.py  # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤
‚îú‚îÄ‚îÄ element_detector.py   # –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ content_analyzer.py   # –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ 
‚îú‚îÄ‚îÄ interface.py          # –ì–ª–∞–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ benchmark.py          # –ë–µ–Ω—á–º–∞—Ä–∫–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤
‚îî‚îÄ‚îÄ __init__.py          # –ü—É–±–ª–∏—á–Ω—ã–π API
```

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```mermaid
graph TD
    A[Markdown Text] --> B[Stage1Interface]
    B --> C[MarkdownParser]
    B --> D[FencedBlockExtractor]
    B --> E[ElementDetector]
    B --> F[ContentAnalyzer]
    
    C --> G[MarkdownNode AST]
    D --> H[List[FencedBlock]]
    E --> I[ElementCollection]
    F --> J[ContentAnalysis]
    
    G --> K[Stage1Results]
    H --> K
    I --> K
    J --> K
    
    K --> L[Stage 2 Input]
```

## üß© –°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. üìä –°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö (types.py)
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö:
- `Position` - –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ç–µ–∫—Å—Ç–µ
- `MarkdownNode` - —É–∑–ª—ã AST
- `FencedBlock` - –æ–≥—Ä–∞–∂–¥–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏
- `Header`, `MarkdownList`, `Table` - —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- `ContentAnalysis` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞

### 2. üîß –°–ª–æ–π –ø–∞—Ä—Å–∏–Ω–≥–∞
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ Markdown:
- `MarkdownParser` - –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –ø–∞—Ä—Å–µ—Ä
- `MarkdownItPyAdapter` - –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è markdown-it-py
- `MistuneAdapter` - –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è mistune
- `CommonMarkAdapter` - –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è commonmark

### 3. üîç –°–ª–æ–π –∞–Ω–∞–ª–∏–∑–∞
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:
- `FencedBlockExtractor` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞
- `ElementDetector` - –ø–æ–∏—Å–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- `ContentAnalyzer` - –∞–Ω–∞–ª–∏–∑ –∏ –º–µ—Ç—Ä–∏–∫–∏

### 4. üéõÔ∏è –°–ª–æ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏:
- `Stage1Interface` - –≥–ª–∞–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- `Stage1Config` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `ErrorCollector` - —Å–±–æ—Ä –æ—à–∏–±–æ–∫

### 5. üåê –ü—É–±–ª–∏—á–Ω—ã–π API
–£–¥–æ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- `process_markdown()` - –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- `analyze_markdown()` - —Ç–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑
- `parse_to_ast()` - —Ç–æ–ª—å–∫–æ –ø–∞—Ä—Å–∏–Ω–≥

## üîå –¢–æ—á–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞
```python
class MyCustomAdapter(MarkdownParser):
    def parse(self, text: str) -> MarkdownNode:
        # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞
        pass
    
    def supports_positions(self) -> bool:
        return True
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
```python
class MyAnalyzer:
    def analyze(self, ast: MarkdownNode) -> MyAnalysisResult:
        # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞
        pass
```

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - –ü–∞—Ä—Å–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
2. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–µ—à–∏—Ä—É—é—Ç—Å—è
3. **–ü–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –ë–æ–ª—å—à–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ —á–∞—Å—Ç—è–º
4. **–ü—É–ª—ã –æ–±—ä–µ–∫—Ç–æ–≤** - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—è–∂–µ–ª—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

## üõ°Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:

1. **–£—Ä–æ–≤–µ–Ω—å –ø–∞—Ä—Å–µ—Ä–∞** - Fallback –Ω–∞ –¥—Ä—É–≥–∏–µ –ø–∞—Ä—Å–µ—Ä—ã
2. **–£—Ä–æ–≤–µ–Ω—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞** - Graceful degradation
3. **–£—Ä–æ–≤–µ–Ω—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞** - –°–±–æ—Ä –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –æ—à–∏–±–æ–∫
4. **–£—Ä–æ–≤–µ–Ω—å API** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–µ—Ç—Ä–∏–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç:
- –í—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –û—à–∏–±–∫–∏ –∏ –∏—Ö —Ç–∏–ø—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–µ—Ä–æ–≤

## üîÆ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ Stage 2

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Stage 1 —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Stage 2:

1. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—ã—Ö–æ–¥—ã** - –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –µ–¥–∏–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
2. **–ë–æ–≥–∞—Ç—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** - –ü–æ–∑–∏—Ü–∏–∏, —Ç–∏–ø—ã, —Å–≤—è–∑–∏ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
3. **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —á–∞–Ω–∫–æ–≤–∞–Ω–∏—è
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –∫–æ—Ä–ø—É—Å–æ–≤